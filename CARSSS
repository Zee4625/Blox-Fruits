--== PLAYER SETUP ==--
local player = game.Players.LocalPlayer
local character = player.Character or player.CharacterAdded:Wait()
local humanoidRootPart = character:WaitForChild("HumanoidRootPart")

--== SERVICES ==--
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")

--== SPEED SETTINGS ==--
local speedActive = false
local bodyVelocity
local currentSpeed = 0
local handBrakeActive = false
local hyperActive = false
local groundOffset = 0.2

-- Trepte de viteza modificate
local speedStages = {
    {speeds = {5,8,11,13,16,18,22,25,27,32,35,40,46,52,66,77,90,100, 120}, delay = 0.06},
    {speeds = {150, 170, 185}, delay = 0.4}, 
    {speeds = {190, 200, 230, 250, 260, 270, 285, 295, 300, 320}, delay = 0.6},
    {speeds = {320, 340, 360, 380, 420, 460, 480, 510}, delay = 1.1}
}

local stageIndex = 1
local gearIndex = 1

--== GUI SETUP ==--
local screenGui = Instance.new("ScreenGui")
screenGui.Name = "CarSpeedGUI"
screenGui.ResetOnSpawn = false
screenGui.Parent = player:WaitForChild("PlayerGui")

local mainFrame = Instance.new("Frame")
mainFrame.Size = UDim2.new(0, 300, 0, 200)
mainFrame.Position = UDim2.new(0, 100, 0, 100)
mainFrame.BackgroundColor3 = Color3.fromRGB(25, 25, 25)
mainFrame.BorderSizePixel = 0
mainFrame.Parent = screenGui

-- Draggable
local dragging, dragInput, dragStart, startPos
mainFrame.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 then
        dragging = true
        dragStart = input.Position
        startPos = mainFrame.Position
        input.Changed:Connect(function()
            if input.UserInputState == Enum.UserInputState.End then
                dragging = false
            end
        end)
    end
end)
mainFrame.InputChanged:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseMovement then
        dragInput = input
    end
end)
UserInputService.InputChanged:Connect(function(input)
    if dragging and input == dragInput then
        local delta = input.Position - dragStart
        mainFrame.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
    end
end)

-- Title
local title = Instance.new("TextLabel")
title.Size = UDim2.new(1, 0, 0, 30)
title.Position = UDim2.new(0, 0, 0, 0)
title.BackgroundTransparency = 1
title.TextColor3 = Color3.fromRGB(0, 255, 0)
title.Text = "Car Speed Auto"
title.Font = Enum.Font.SourceSansBold
title.TextSize = 18
title.Parent = mainFrame

-- Toggle Speed
local toggleButton = Instance.new("TextButton")
toggleButton.Size = UDim2.new(1, -20, 0, 30)
toggleButton.Position = UDim2.new(0, 10, 0, 35)
toggleButton.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
toggleButton.TextColor3 = Color3.fromRGB(255, 255, 255)
toggleButton.Text = "Speed OFF"
toggleButton.Font = Enum.Font.SourceSansBold
toggleButton.TextSize = 16
toggleButton.Parent = mainFrame

-- Handbrake
local handBrakeButton = Instance.new("TextButton")
handBrakeButton.Size = UDim2.new(1, -20, 0, 30)
handBrakeButton.Position = UDim2.new(0, 10, 0, 70)
handBrakeButton.BackgroundColor3 = Color3.fromRGB(150, 0, 0)
handBrakeButton.TextColor3 = Color3.fromRGB(255, 255, 255)
handBrakeButton.Text = "Handbrake OFF"
handBrakeButton.Font = Enum.Font.SourceSansBold
handBrakeButton.TextSize = 16
handBrakeButton.Parent = mainFrame

-- Hyper Button
local hyperButton = Instance.new("TextButton")
hyperButton.Size = UDim2.new(1, -20, 0, 30)
hyperButton.Position = UDim2.new(0, 10, 0, 105)
hyperButton.BackgroundColor3 = Color3.fromRGB(0, 100, 255)
hyperButton.TextColor3 = Color3.fromRGB(255, 255, 255)
hyperButton.Text = "Hyper OFF"
hyperButton.Font = Enum.Font.SourceSansBold
hyperButton.TextSize = 16
hyperButton.Parent = mainFrame

-- Speed display
local speedLabel = Instance.new("TextLabel")
speedLabel.Size = UDim2.new(1, 0, 0, 20)
speedLabel.Position = UDim2.new(0, 0, 0, 150)
speedLabel.BackgroundTransparency = 1
speedLabel.TextColor3 = Color3.fromRGB(0, 255, 0)
speedLabel.Text = "Speed: 0"
speedLabel.Font = Enum.Font.SourceSansBold
speedLabel.TextSize = 16
speedLabel.Parent = mainFrame

--== FUNCTIONS ==--
local function startSpeed()
    if not bodyVelocity then
        bodyVelocity = Instance.new("BodyVelocity")
        bodyVelocity.MaxForce = Vector3.new(9e9, 0, 9e9)
        bodyVelocity.Velocity = Vector3.new(0,0,0)
        bodyVelocity.Parent = humanoidRootPart
    end

    stageIndex = 1
    gearIndex = 1
    currentSpeed = speedStages[stageIndex].speeds[gearIndex]
    speedLabel.Text = "Speed: "..currentSpeed

    spawn(function()
        while speedActive do
            if handBrakeActive then
                currentSpeed = 0
            else
                gearIndex = gearIndex + 1
                local speeds = speedStages[stageIndex].speeds
                local delayTime = speedStages[stageIndex].delay
                if hyperActive then
                    delayTime = math.max(0.01, delayTime - 0.4) -- scurteaza cu 0.4 sec
                end
                if gearIndex > #speeds then
                    stageIndex = math.min(stageIndex + 1, #speedStages)
                    gearIndex = 1
                    speeds = speedStages[stageIndex].speeds
                    delayTime = speedStages[stageIndex].delay
                    if hyperActive then
                        delayTime = math.max(0.01, delayTime - 0.4)
                    end
                end
                currentSpeed = speeds[gearIndex]
            end
            speedLabel.Text = "Speed: "..currentSpeed
            wait(delayTime)
        end
    end)
end

local function stopSpeed()
    if bodyVelocity then
        bodyVelocity:Destroy()
        bodyVelocity = nil
    end
    currentSpeed = 0
    gearIndex = 1
    stageIndex = 1
    speedLabel.Text = "Speed: 0"
end

-- Toggle buttons
toggleButton.MouseButton1Click:Connect(function()
    speedActive = not speedActive
    toggleButton.Text = speedActive and "Speed ON" or "Speed OFF"
    if speedActive then
        startSpeed()
    else
        stopSpeed()
    end
end)

handBrakeButton.MouseButton1Click:Connect(function()
    handBrakeActive = not handBrakeActive
    handBrakeButton.Text = handBrakeActive and "Handbrake ON" or "Handbrake OFF"
end)

hyperButton.MouseButton1Click:Connect(function()
    hyperActive = not hyperActive
    hyperButton.Text = hyperActive and "Hyper ON" or "Hyper OFF"
end)

--== MOVEMENT LOOP ==--
RunService.Heartbeat:Connect(function()
    if speedActive and bodyVelocity then
        local dir = Vector3.new()
        -- W/S = viteza curenta
        if UserInputService:IsKeyDown(Enum.KeyCode.W) then dir += humanoidRootPart.CFrame.LookVector * currentSpeed end
        if UserInputService:IsKeyDown(Enum.KeyCode.S) then dir -= humanoidRootPart.CFrame.LookVector * currentSpeed end
        -- A/D = lateral mic, 2-3
        if UserInputService:IsKeyDown(Enum.KeyCode.A) then dir -= humanoidRootPart.CFrame.RightVector * 3 end
        if UserInputService:IsKeyDown(Enum.KeyCode.D) then dir += humanoidRootPart.CFrame.RightVector * 3 end

        if dir.Magnitude > 0 then
            bodyVelocity.Velocity = dir + Vector3.new(0,groundOffset,0)
        else
            bodyVelocity.Velocity = Vector3.new(0,groundOffset,0)
        end
    end
end)
