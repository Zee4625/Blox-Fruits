--== PLAYER SETUP ==--
local player = game.Players.LocalPlayer
local character = player.Character or player.CharacterAdded:Wait()
local humanoidRootPart = character:WaitForChild("HumanoidRootPart")

--== SERVICES ==--
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")

--== CORE VARIABLES ==--
local speedActive = false
local bodyVelocity
local currentSpeed = 0
local targetSpeed = 0
local handBrakeActive = false
local groundOffset = 0.2
local fakeW = false
local currentGear = 1
local shifting = false
local rpm = 0

--== VEHICLE SETTINGS ==--
local naturalDecel = 0.97
local brakeRate = 0.9
local handBrakeRate = 0.65
local turnSpeed = 3
local gearUpDelay = 0.15
local gearDownDelay = 0.25
local maxGear = 8

--== GEAR DATA ==--
local gearSpeeds = { 30, 60, 110, 180, 270, 380, 470, 570 } -- viteze maxime per gear
local gearAccel = { 1.25, 1.20, 1.15, 1.10, 1.06, 1.04, 1.02, 1.01 } -- accelerație mai mică la gear mare

--== GUI SETUP ==--
local screenGui = Instance.new("ScreenGui")
screenGui.Name = "ZeeModsGUI"
screenGui.ResetOnSpawn = false
screenGui.Parent = player:WaitForChild("PlayerGui")

local mainFrame = Instance.new("Frame")
mainFrame.Size = UDim2.new(0, 360, 0, 260)
mainFrame.Position = UDim2.new(0, 100, 0, 100)
mainFrame.BackgroundColor3 = Color3.fromRGB(15, 15, 15)
mainFrame.BorderSizePixel = 0
mainFrame.Active = true
mainFrame.Draggable = true
mainFrame.Parent = screenGui

local titleBar = Instance.new("Frame")
titleBar.Size = UDim2.new(1, 0, 0, 30)
titleBar.BackgroundColor3 = Color3.fromRGB(0, 150, 255)
titleBar.Parent = mainFrame

local titleLabel = Instance.new("TextLabel")
titleLabel.Size = UDim2.new(1, 0, 1, 0)
titleLabel.BackgroundTransparency = 1
titleLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
titleLabel.Font = Enum.Font.SourceSansBold
titleLabel.TextSize = 18
titleLabel.Text = "⚙️ Zee MODS – Real Auto Gear System"
titleLabel.Parent = titleBar

--== BUTTONS ==--
local toggleButton = Instance.new("TextButton")
toggleButton.Size = UDim2.new(1, -20, 0, 30)
toggleButton.Position = UDim2.new(0, 10, 0, 40)
toggleButton.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
toggleButton.TextColor3 = Color3.fromRGB(0, 255, 0)
toggleButton.Font = Enum.Font.SourceSansBold
toggleButton.TextSize = 16
toggleButton.Text = "Speed OFF"
toggleButton.Parent = mainFrame

local handBrakeButton = Instance.new("TextButton")
handBrakeButton.Size = UDim2.new(1, -20, 0, 30)
handBrakeButton.Position = UDim2.new(0, 10, 0, 75)
handBrakeButton.BackgroundColor3 = Color3.fromRGB(150, 0, 0)
handBrakeButton.TextColor3 = Color3.fromRGB(255, 255, 255)
handBrakeButton.Font = Enum.Font.SourceSansBold
handBrakeButton.TextSize = 16
handBrakeButton.Text = "Handbrake OFF"
handBrakeButton.Parent = mainFrame

local gearSelectLabel = Instance.new("TextLabel")
gearSelectLabel.Size = UDim2.new(1, -20, 0, 20)
gearSelectLabel.Position = UDim2.new(0, 10, 0, 115)
gearSelectLabel.BackgroundTransparency = 1
gearSelectLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
gearSelectLabel.Font = Enum.Font.SourceSansBold
gearSelectLabel.TextSize = 16
gearSelectLabel.Text = "Max Gear: " .. maxGear
gearSelectLabel.Parent = mainFrame

local gearPlus = Instance.new("TextButton")
gearPlus.Size = UDim2.new(0, 30, 0, 20)
gearPlus.Position = UDim2.new(1, -40, 0, 115)
gearPlus.BackgroundColor3 = Color3.fromRGB(0, 150, 255)
gearPlus.TextColor3 = Color3.fromRGB(255, 255, 255)
gearPlus.Font = Enum.Font.SourceSansBold
gearPlus.TextSize = 16
gearPlus.Text = "+"
gearPlus.Parent = mainFrame

local gearMinus = Instance.new("TextButton")
gearMinus.Size = UDim2.new(0, 30, 0, 20)
gearMinus.Position = UDim2.new(1, -80, 0, 115)
gearMinus.BackgroundColor3 = Color3.fromRGB(0, 150, 255)
gearMinus.TextColor3 = Color3.fromRGB(255, 255, 255)
gearMinus.Font = Enum.Font.SourceSansBold
gearMinus.TextSize = 16
gearMinus.Text = "-"
gearMinus.Parent = mainFrame

local speedLabel = Instance.new("TextLabel")
speedLabel.Size = UDim2.new(1, 0, 0, 25)
speedLabel.Position = UDim2.new(0, 0, 0, 145)
speedLabel.BackgroundTransparency = 1
speedLabel.TextColor3 = Color3.fromRGB(0, 255, 0)
speedLabel.Font = Enum.Font.SourceSansBold
speedLabel.TextSize = 20
speedLabel.Text = "Speed: 0 km/h"
speedLabel.Parent = mainFrame

local gearLabel = Instance.new("TextLabel")
gearLabel.Size = UDim2.new(1, 0, 0, 25)
gearLabel.Position = UDim2.new(0, 0, 0, 170)
gearLabel.BackgroundTransparency = 1
gearLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
gearLabel.Font = Enum.Font.SourceSansBold
gearLabel.TextSize = 20
gearLabel.Text = "Gear: 1"
gearLabel.Parent = mainFrame

local rpmBarBg = Instance.new("Frame")
rpmBarBg.Size = UDim2.new(1, -40, 0, 20)
rpmBarBg.Position = UDim2.new(0, 20, 0, 200)
rpmBarBg.BackgroundColor3 = Color3.fromRGB(60, 60, 60)
rpmBarBg.BorderSizePixel = 0
rpmBarBg.Parent = mainFrame

local rpmBar = Instance.new("Frame")
rpmBar.Size = UDim2.new(0, 0, 1, 0)
rpmBar.BackgroundColor3 = Color3.fromRGB(255, 100, 0)
rpmBar.BorderSizePixel = 0
rpmBar.Parent = rpmBarBg

--== BUTTON ACTIONS ==--
gearPlus.MouseButton1Click:Connect(function()
	if maxGear < 8 then
		maxGear += 1
		gearSelectLabel.Text = "Max Gear: " .. maxGear
	end
end)

gearMinus.MouseButton1Click:Connect(function()
	if maxGear > 1 then
		maxGear -= 1
		gearSelectLabel.Text = "Max Gear: " .. maxGear
	end
end)

toggleButton.MouseButton1Click:Connect(function()
	speedActive = not speedActive
	toggleButton.Text = speedActive and "Speed ON" or "Speed OFF"
	if speedActive then
		if not bodyVelocity then
			bodyVelocity = Instance.new("BodyVelocity")
			bodyVelocity.MaxForce = Vector3.new(9e9, 0, 9e9)
			bodyVelocity.Velocity = Vector3.zero
			bodyVelocity.Parent = humanoidRootPart
		end
	else
		if bodyVelocity then bodyVelocity:Destroy() end
		bodyVelocity = nil
		currentSpeed = 0
		targetSpeed = 0
		fakeW = false
	end
end)

handBrakeButton.MouseButton1Click:Connect(function()
	handBrakeActive = not handBrakeActive
	handBrakeButton.Text = handBrakeActive and "Handbrake ON" or "Handbrake OFF"
end)

UserInputService.InputBegan:Connect(function(input)
	if input.KeyCode == Enum.KeyCode.W and speedActive then
		fakeW = true
	end
end)

UserInputService.InputEnded:Connect(function(input)
	if input.KeyCode == Enum.KeyCode.W and speedActive then
		fakeW = true -- cruise continuu
	end
end)

--== GEAR SHIFT ==--
local function shiftUp()
	if shifting or currentGear >= maxGear then return end
	shifting = true
	currentGear += 1
	wait(gearUpDelay)
	shifting = false
end

local function shiftDown()
	if shifting or currentGear <= 1 then return end
	shifting = true
	currentGear -= 1
	wait(gearDownDelay)
	shifting = false
end

--== MAIN LOOP ==--
RunService.Heartbeat:Connect(function()
	if not speedActive or not bodyVelocity then return end

	local dir = Vector3.zero
	local pressingW = UserInputService:IsKeyDown(Enum.KeyCode.W)
	local pressingS = UserInputService:IsKeyDown(Enum.KeyCode.S)

	-- accelerație dependentă de gear
	local accelMultiplier = gearAccel[currentGear] or 1.0

	if pressingW and not handBrakeActive then
		targetSpeed = math.min(targetSpeed * accelMultiplier + 1, gearSpeeds[maxGear])
	elseif fakeW and not pressingS then
		targetSpeed = math.max(targetSpeed * naturalDecel, 0)
	else
		targetSpeed = targetSpeed * naturalDecel
	end

	if pressingS then
		targetSpeed = targetSpeed * brakeRate
		fakeW = false
	end

	if handBrakeActive then
		targetSpeed = targetSpeed * handBrakeRate
		fakeW = false
	end

	local gearMax = gearSpeeds[currentGear]
	if targetSpeed > gearMax * 0.95 and currentGear < maxGear then
		shiftUp()
	elseif targetSpeed < gearMax * 0.5 and currentGear > 1 then
		shiftDown()
	end

	currentSpeed = currentSpeed + (targetSpeed - currentSpeed) * 0.2
	rpm = (currentSpeed / gearSpeeds[currentGear])
	rpm = math.clamp(rpm, 0, 1)

	if UserInputService:IsKeyDown(Enum.KeyCode.A) then
		dir -= humanoidRootPart.CFrame.RightVector * turnSpeed
	end
	if UserInputService:IsKeyDown(Enum.KeyCode.D) then
		dir += humanoidRootPart.CFrame.RightVector * turnSpeed
	end

	dir += humanoidRootPart.CFrame.LookVector * currentSpeed
	bodyVelocity.Velocity = dir + Vector3.new(0, groundOffset, 0)

	speedLabel.Text = "Speed: " .. math.floor(currentSpeed) .. " km/h"
	gearLabel.Text = "Gear: " .. currentGear
	rpmBar.Size = UDim2.new(rpm, 0, 1, 0)

	if currentSpeed < 5 then fakeW = false end
end)
